 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ExamPrep AI Tutor</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary: #4361ee;
      --primary-light: #e6e9ff;
      --text: #2b2d42;
      --text-light: #8d99ae;
      --bg: #f8f9fa;
      --card-bg: #ffffff;
      --success: #4cc9f0;
      --warning: #f8961e;
      --danger: #ef233c;
      --xp-color: #7209b7;
      --streak-color: #f8961e;
      --badge-color: #3a86ff;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }
    
    body {
      background-color: var(--bg);
      color: var(--text);
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }
    
    .auth-buttons {
      display: flex;
      gap: 10px;
    }
    
    .auth-btn {
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
    }
    
    .login-btn {
      background: white;
      border: 1px solid var(--primary);
      color: var(--primary);
    }
    
    .signup-btn {
      background: var(--primary);
      border: 1px solid var(--primary);
      color: white;
    }
    
    h1 {
      font-size: 2rem;
      color: var(--primary);
    }
    
    .subtitle {
      font-size: 1.1rem;
      color: var(--text-light);
      margin-bottom: 30px;
    }
    
    .main-app {
      display: flex;
      gap: 30px;
      flex: 1;
    }
    
    .sidebar {
      width: 300px;
      background: var(--card-bg);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      overflow-y: auto;
    }
    
    .content-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .tab-header {
      display: flex;
      border-bottom: 1px solid #eee;
      margin-bottom: 20px;
      overflow-x: auto;
    }
    
    .tab-btn {
      padding: 10px 20px;
      background: none;
      border: none;
      cursor: pointer;
      font-weight: 500;
      color: var(--text-light);
      position: relative;
      white-space: nowrap;
    }
    
    .tab-btn.active {
      color: var(--primary);
    }
    
    .tab-btn.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      width: 100%;
      height: 2px;
      background: var(--primary);
    }
    
    .chat-container, .test-container, .dashboard-container, .flashcard-container, .challenge-container, .profile-container {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      display: flex;
      flex-direction: column;
      flex: 1;
      overflow: hidden;
    }
    
    .chat-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
      margin-bottom: 20px;
    }
    
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding-right: 10px;
      margin-bottom: 20px;
    }
    
    .message {
      margin-bottom: 15px;
      display: flex;
    }
    
    .user-message {
      justify-content: flex-end;
    }
    
    .bot-message {
      justify-content: flex-start;
    }
    
    .message-content {
      max-width: 80%;
      padding: 12px 16px;
      border-radius: 18px;
      line-height: 1.5;
    }
    
    .user-message .message-content {
      background-color: var(--primary);
      color: white;
      border-bottom-right-radius: 4px;
    }
    
    .bot-message .message-content {
      background-color: var(--primary-light);
      color: var(--text);
      border-bottom-left-radius: 4px;
    }
    
    .bot-message .message-content strong {
      font-weight: 600;
    }
    
    .bot-message .message-content em {
      font-style: italic;
    }
    
    .bot-message .message-content table {
      border-collapse: collapse;
      margin: 10px 0;
      width: 100%;
    }
    
    .bot-message .message-content table, 
    .bot-message .message-content th, 
    .bot-message .message-content td {
      border: 1px solid #ddd;
    }
    
    .bot-message .message-content th, 
    .bot-message .message-content td {
      padding: 8px;
      text-align: left;
    }
    
    .bot-message .message-content ul {
      margin-left: 20px;
    }
    
    .input-area {
      display: flex;
      gap: 10px;
    }
    
    .message-input {
      flex: 1;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
      resize: none;
      min-height: 50px;
    }
    
    .action-btn {
      color: white;
      border: none;
      border-radius: 8px;
      padding: 0 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .send-btn {
      background-color: var(--primary);
    }
    
    .upload-btn {
      background-color: white;
      color: var(--primary);
      border: 1px solid var(--primary);
    }
    
    .subject-card {
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .subject-card:hover {
      background-color: var(--primary-light);
    }
    
    .subject-card.active {
      background-color: var(--primary);
      color: white;
    }
    
    .subject-icon {
      font-size: 1.2rem;
    }
    
    .test-params {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .param-group {
      display: flex;
      flex-direction: column;
    }
    
    .param-label {
      margin-bottom: 5px;
      font-weight: 500;
    }
    
    .param-select, .param-input {
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 1rem;
    }
    
    .generate-btn {
      background-color: var(--success);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 10px;
    }
    
    .test-questions {
      flex: 1;
      overflow-y: auto;
      padding: 10px;
      border: 1px solid #eee;
      border-radius: 8px;
      margin-bottom: 15px;
    }
    
    .question-item {
      padding: 15px;
      border-bottom: 1px solid #eee;
    }
    
    .question-item:last-child {
      border-bottom: none;
    }
    
    .question-text {
      font-weight: 500;
      margin-bottom: 10px;
    }
    
    .question-options {
      margin-left: 20px;
    }
    
    .option-item {
      margin-bottom: 5px;
    }
    
    .saved-responses {
      margin-top: 20px;
    }
    
    .saved-title {
      font-weight: 500;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .saved-list {
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #eee;
      border-radius: 8px;
      padding: 10px;
    }
    
    .saved-item {
      padding: 10px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
    }
    
    .saved-item:hover {
      background-color: var(--primary-light);
    }
    
    .saved-item:last-child {
      border-bottom: none;
    }
    
    .typing-indicator {
      display: flex;
      align-items: center;
      gap: 5px;
      color: var(--text-light);
      font-style: italic;
    }
        .dot {
      width: 8px;
      height: 8px;
      background-color: var(--text-light);
      border-radius: 50%;
      animation: bounce 1.4s infinite ease-in-out;
    }
    
    .dot:nth-child(2) {
      animation-delay: 0.2s;
    }
    
    .dot:nth-child(3) {
      animation-delay: 0.4s;
    }
    
    @keyframes bounce {
      0%, 80%, 100% { transform: scale(0); }
      40% { transform: scale(1); }
    }
    
    .file-upload {
      display: none;
    }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 100;
      justify-content: center;
      align-items: center;
    }
    
    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 12px;
      width: 400px;
      max-width: 90%;
    }
    
    .modal-title {
      font-size: 1.5rem;
      margin-bottom: 20px;
      color: var(--primary);
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
    }
    
    .form-input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 1rem;
    }
    
    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 20px;
    }
    
    .modal-btn {
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
    }
    
    .modal-cancel {
      background: white;
      border: 1px solid #ddd;
    }
    
    .modal-submit {
      background: var(--primary);
      border: 1px solid var(--primary);
      color: white;
    }
    
    .user-profile {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
    }
    
    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }
    
    .user-name {
      font-weight: 500;
    }
    
    /* Gamification styles */
    .gamification-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: white;
      padding: 10px 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .xp-level {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .xp-bar {
      flex: 1;
      height: 10px;
      background: #eee;
      border-radius: 5px;
      overflow: hidden;
      max-width: 150px;
    }
    
    .xp-progress {
      height: 100%;
      background: var(--xp-color);
      width: 30%;
      transition: width 0.3s;
    }
    
    .streak {
      display: flex;
      align-items: center;
      gap: 5px;
      color: var(--streak-color);
    }
    
    .badges {
      display: flex;
      gap: 5px;
    }
    
    .badge {
      width: 25px;
      height: 25px;
      border-radius: 50%;
      background: var(--badge-color);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }
    
    /* Exam presets */
    .exam-presets {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 10px;
      margin-bottom: 20px;
    }
    
    .preset-btn {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 6px;
      background: white;
      cursor: pointer;
      font-size: 0.9rem;
      text-align: center;
    }
    
    .preset-btn:hover {
      background: var(--primary-light);
      border-color: var(--primary);
    }
    
    /* Flashcards */
    .flashcard {
      perspective: 1000px;
      width: 100%;
      height: 300px;
      margin: 20px auto;
    }
    
    .flashcard-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transition: transform 0.6s;
      transform-style: preserve-3d;
    }
    
    .flashcard.flipped .flashcard-inner {
      transform: rotateY(180deg);
    }
    
    .flashcard-front, .flashcard-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 12px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      background: white;
    }
    
    .flashcard-back {
      transform: rotateY(180deg);
    }
    
    .flashcard-nav {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
    }
    
    .flashcard-btn {
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      border: none;
    }
    
    .know-btn {
      background: var(--success);
      color: white;
    }
    
    .dont-know-btn {
      background: var(--danger);
      color: white;
    }
    
    .flip-btn {
      background: var(--primary);
      color: white;
    }
    
    /* Dashboard */
    .dashboard-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .stat-card {
      background: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .stat-title {
      font-size: 0.9rem;
      color: var(--text-light);
      margin-bottom: 5px;
    }
    
    .stat-value {
      font-size: 1.5rem;
      font-weight: 600;
    }
    
    .progress-chart {
      height: 300px;
      background: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    
    .weak-areas {
      background: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .weak-area-item {
      padding: 10px 0;
      border-bottom: 1px solid #eee;
    }
    
    .weak-area-item:last-child {
      border-bottom: none;
    }
    
    /* Challenges */
    .challenge-form {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .challenge-friend {
      background: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    
    .challenge-list {
      background: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      max-height: 300px;
      overflow-y: auto;
    }
    
    .challenge-item {
      padding: 10px 0;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .challenge-item:last-child {
      border-bottom: none;
    }
    
    /* Profile */
    .profile-section {
      margin-bottom: 20px;
    }
    
    .profile-header {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .profile-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      font-weight: bold;
      margin-right: 20px;
    }
    
    .profile-info h3 {
      margin-bottom: 5px;
    }
    
    .profile-info p {
      color: var(--text-light);
    }
    
    .qualification-form {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .qualification-item {
      background: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 10px;
    }
    
    /* Mindfulness popup */
    .mindfulness-popup {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      max-width: 300px;
      z-index: 50;
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s;
    }
    
    .mindfulness-popup.show {
      transform: translateY(0);
      opacity: 1;
    }
    
    .mindfulness-close {
      position: absolute;
      top: 5px;
      right: 5px;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1rem;
    }
    
    .mindfulness-title {
      color: var(--primary);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .mindfulness-text {
      margin-bottom: 10px;
    }
    
    .mindfulness-btn {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 6px;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 0.9rem;
    }
    
    /* Animations */
    .typing-animation {
      display: inline-block;
      overflow: hidden;
      border-right: 2px solid var(--primary);
      white-space: nowrap;
      animation: typing 3.5s steps(40, end), blink-caret 0.75s step-end infinite;
    }
    
    @keyframes typing {
      from { width: 0 }
      to { width: 100% }
    }
    
    @keyframes blink-caret {
      from, to { border-color: transparent }
      50% { border-color: var(--primary); }
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .pulse {
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    .shake {
      animation: shake 0.5s;
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
      20%, 40%, 60%, 80% { transform: translateX(5px); }
    }
    
    /* Tooltips */
    .tooltip {
      position: relative;
      display: inline-block;
    }
    
    .tooltip .tooltiptext {
      visibility: hidden;
      width: 120px;
      background-color: #555;
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 5px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      margin-left: -60px;
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .main-app {
        flex-direction: column;
      }
      
      .sidebar {
        width: 100%;
      }
      
      .test-params {
        grid-template-columns: 1fr;
      }
      
      .dashboard-stats {
        grid-template-columns: 1fr;
      }
      
      .qualification-form {
        grid-template-columns: 1fr;
      }
      
      .message-content {
        max-width: 85%;
      }
    }
    .chat-container {
  max-width: 800px;
  margin: 0 auto;
  padding: 20px;
}

#userInput {
  width: 100%;
  height: 100px;
  margin-bottom: 10px;
}

button {
  padding: 8px 15px;
  margin-right: 10px;
  cursor: pointer;
}

#stopBtn {
  background-color: #ff4444;
  color: white;
}

.response-container {
  margin-top: 20px;
  border: 1px solid #ddd;
  padding: 15px;
  position: relative;
}

#copyBtn, #editBtn {
  position: absolute;
  top: 5px;
  right: 5px;
  padding: 3px 8px;
  font-size: 12px;
}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ExamPrep AI Tutor</h1>
      <div class="auth-buttons" id="authButtons">
        <button class="auth-btn login-btn" id="loginBtn">Log In</button>
        <button class="auth-btn signup-btn" id="signupBtn">Sign Up</button>
      </div>
      <div class="user-profile" id="userProfile" style="display: none;">
        <div class="user-avatar" id="userAvatar">U</div>
        <span class="user-name" id="userName">User</span>
      </div>
    </header>
    
    <div class="gamification-bar" id="gamificationBar" style="display: none;">
      <div class="xp-level">
        <span>Level 1</span>
        <div class="xp-bar">
          <div class="xp-progress" id="xpProgress"></div>
        </div>
        <span id="xpText">30/100 XP</span>
      </div>
      <div class="streak">
        <i class="fas fa-fire"></i>
        <span id="streakCount">3 day streak</span>
      </div>
      <div class="badges">
        <div class="badge tooltip" id="badge1">
          <i class="fas fa-star"></i>
          <span class="tooltiptext">Newbie - First test completed</span>
        </div>
        <div class="badge tooltip" id="badge2" style="display: none;">
          <i class="fas fa-book"></i>
          <span class="tooltiptext">Bookworm - 10 questions answered</span>
        </div>
      </div>
    </div>
    
    <div class="main-app">
      <div class="sidebar">
        <h3>Subjects</h3>
        <div class="subject-card active">
          <i class="fas fa-square-root-alt subject-icon"></i>
          <span>Mathematics</span>
        </div>
        <div class="subject-card">
          <i class="fas fa-flask subject-icon"></i>
          <span>Science</span>
        </div>
        <div class="subject-card">
          <i class="fas fa-book subject-icon"></i>
          <span>Language Arts</span>
        </div>
        <div class="subject-card">
          <i class="fas fa-landmark subject-icon"></i>
          <span>History</span>
        </div>
        <div class="subject-card">
          <i class="fas fa-code subject-icon"></i>
          <span>Computer Science</span>
        </div>
        <div class="subject-card">
          <i class="fas fa-chart-line subject-icon"></i>
          <span>Economics</span>
        </div>
        <div class="subject-card">
          <i class="fas fa-robot subject-icon"></i>
          <span>Artificial Intelligence</span>
        </div>
        <div class="subject-card">
          <i class="fas fa-database subject-icon"></i>
          <span>Data Structures</span>
        </div>
        <div class="subject-card">
          <i class="fas fa-project-diagram subject-icon"></i>
          <span>Algorithms</span>
        </div>
        
        <div class="saved-responses">
          <div class="saved-title">
            <i class="fas fa-bookmark"></i>
            <span>Saved Responses</span>
          </div>
          <div class="saved-list" id="savedList">
            <!-- Saved items will appear here -->
          </div>
        </div>
      </div>
      
      <div class="content-area">
        <div class="tab-header">
          <button class="tab-btn active" data-tab="chat">Chat Tutor</button>
          <button class="tab-btn" data-tab="test">Test Generator</button>
          <button class="tab-btn" data-tab="flashcards">Flashcards</button>
          <button class="tab-btn" data-tab="dashboard">Dashboard</button>
          <button class="tab-btn" data-tab="challenge">Challenges</button>
          <button class="tab-btn" data-tab="profile">Profile</button>
        </div>
        
        <div class="chat-container" id="chatTab">
          <div class="chat-header">
            <h3>AI Exam Preparation Tutor</h3>
            <div class="typing-indicator" id="typingIndicator" style="display: none;">
              <span>AI is typing</span>
              <div class="dot"></div>
              <div class="dot"></div>
              <div class="dot"></div>
            </div>
          </div>
          
          <div class="chat-messages" id="chatMessages">
            <!-- Messages will appear here -->
          </div>
          
          <div class="input-area">
            <input type="file" id="fileUpload" class="file-upload" accept="image/*,.pdf">
            <button class="action-btn upload-btn" onclick="document.getElementById('fileUpload').click()">
              <i class="fas fa-paperclip"></i>
            </button>
            <textarea class="message-input" id="messageInput" placeholder="Ask your exam question..."></textarea>
            <button class="action-btn send-btn" id="sendBtn">
              <i class="fas fa-paper-plane"></i>
            </button>
          </div>
        </div>
        
        <div class="test-container" id="testTab" style="display: none;">
          <div class="exam-presets">
            <button class="preset-btn" data-exam="SAT">SAT</button>
            <button class="preset-btn" data-exam="JEE">JEE</button>
            <button class="preset-btn" data-exam="NEET">NEET</button>
            <button class="preset-btn" data-exam="GATE">GATE</button>
            <button class="preset-btn" data-exam="CBSE">CBSE</button>
            <button class="preset-btn" data-exam="ACT">ACT</button>
            <button class="preset-btn" data-exam="GRE">GRE</button>
            <button class="preset-btn" data-exam="IELTS">IELTS</button>
          </div>
          
          <div class="test-params">
            <div class="param-group">
              <label class="param-label">Subject</label>
              <select class="param-select" id="testSubject">
                <option value="Mathematics">Mathematics</option>
                <option value="Science">Science</option>
                <option value="Language Arts">Language Arts</option>
                <option value="History">History</option>
                <option value="Computer Science">Computer Science</option>
                <option value="Economics">Economics</option>
                <option value="Artificial Intelligence">Artificial Intelligence</option>
                <option value="Data Structures">Data Structures</option>
                <option value="Algorithms">Algorithms</option>
              </select>
            </div>
            
            <div class="param-group">
              <label class="param-label">Topic</label>
              <input type="text" class="param-input" id="testTopic" placeholder="e.g. Sorting Algorithms">
            </div>
            
            <div class="param-group">
              <label class="param-label">Question Type</label>
              <select class="param-select" id="questionType">
                <option value="Multiple Choice">Multiple Choice</option>
                <option value="Short Answer">Short Answer</option>
                <option value="True/False">True/False</option>
                <option value="Coding Problem">Coding Problem</option>
                <option value="Essay">Essay</option>
              </select>
            </div>
            
            <div class="param-group">
              <label class="param-label">Difficulty</label>
              <select class="param-select" id="questionDifficulty">
                <option value="Easy">Easy</option>
                <option value="Medium">Medium</option>
                <option value="Hard">Hard</option>
              </select>
            </div>
            
            <div class="param-group">
              <label class="param-label">Number of Questions</label>
              <input type="number" class="param-input" id="questionCount" min="1" max="20" value="5">
            </div>
            
            <div class="param-group">
              <label class="param-label">Time Limit (minutes)</label>
              <input type="number" class="param-input" id="timeLimit" min="5" max="180" value="30">
            </div>
          </div>
          
          <button class="generate-btn" id="generateTestBtn">
            <i class="fas fa-magic"></i>
            Generate Practice Test
          </button>
          
          <div class="test-questions" id="testQuestions">
            <!-- Generated test will appear here -->
          </div>
        </div>
        
        <div class="flashcard-container" id="flashcardTab" style="display: none;">
          <h3>Spaced Repetition Flashcards</h3>
          <p>Review your weak areas with flashcards that adapt to your memory</p>
          
          <div class="flashcard" id="flashcard">
            <div class="flashcard-inner">
              <div class="flashcard-front" id="flashcardFront">
                <h4>Flashcard Question</h4>
                <p id="flashcardQuestion">Loading your flashcards...</p>
                <p><small>Click to flip</small></p>
              </div>
              <div class="flashcard-back" id="flashcardBack">
                <h4>Answer</h4>
                <p id="flashcardAnswer">The answer will appear here</p>
              </div>
            </div>
          </div>
          
          <div class="flashcard-nav">
            <button class="flashcard-btn know-btn" id="knowBtn">
              <i class="fas fa-check"></i> I Know It
            </button>
            <button class="flashcard-btn flip-btn" id="flipBtn">
              <i class="fas fa-sync-alt"></i> Flip Card
            </button>
            <button class="flashcard-btn dont-know-btn" id="dontKnowBtn">
              <i class="fas fa-times"></i> Don't Know
            </button>
          </div>
          
          <button class="generate-btn" id="generateFlashcardsBtn">
            <i class="fas fa-sync"></i>
            Generate New Flashcards
          </button>
        </div>
        
        <div class="dashboard-container" id="dashboardTab" style="display: none;">
          <h3>Learning Dashboard</h3>
          <p>Track your progress and identify areas for improvement</p>
          
          <div class="dashboard-stats">
            <div class="stat-card">
              <div class="stat-title">Total Questions Answered</div>
              <div class="stat-value" id="totalQuestions">0</div>
            </div>
            <div class="stat-card">
              <div class="stat-title">Correct Answers</div>
              <div class="stat-value" id="correctAnswers">0</div>
            </div>
            <div class="stat-card">
              <div class="stat-title">Accuracy</div>
              <div class="stat-value" id="accuracyRate">0%</div>
            </div>
          </div>
          
          <div class="progress-chart" id="progressChart">
            <canvas id="progressChartCanvas"></canvas>
          </div>
          
          <div class="weak-areas">
            <h4>Weak Areas</h4>
            <div id="weakAreasList">
              <div class="weak-area-item">
                <strong>Algebra</strong> - 40% accuracy (10 questions)
              </div>
              <div class="weak-area-item">
                <strong>Geometry</strong> - 55% accuracy (8 questions)
              </div>
            </div>
          </div>
        </div>
        
        <div class="challenge-container" id="challengeTab" style="display: none;">
          <h3>Challenge Your Friends</h3>
          <p>Compete with friends on the same test and compare scores</p>
          
          <div class="challenge-friend">
            <h4>Send Challenge</h4>
            <div class="challenge-form">
              <div class="param-group">
                <label class="param-label">Friend's Email</label>
                <input type="email" class="param-input" id="friendEmail" placeholder="Enter friend's email">
              </div>
              <div class="param-group">
                <label class="param-label">Test Topic</label>
                <input type="text" class="param-input" id="challengeTopic" placeholder="Enter test topic">
              </div>
              <div class="param-group">
                <label class="param-label">Number of Questions</label>
                <input type="number" class="param-input" id="challengeQuestionCount" min="1" max="20" value="5">
              </div>
              <button class="generate-btn" id="sendChallengeBtn">
                <i class="fas fa-paper-plane"></i>
                Send Challenge
              </button>
            </div>
          </div>
          
          <div class="challenge-list">
            <h4>Your Challenges</h4>
            <div id="challengesList">
              <div class="challenge-item">
                <div>
                  <strong>Algebra Basics</strong> - Sent to friend@example.com (Pending)
                </div>
                <button class="action-btn" style="background: var(--danger); padding: 5px 10px; font-size: 0.8rem;">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
              <div class="challenge-item">
                <div>
                  <strong>History Quiz</strong> - Received from classmate@example.com
                </div>
                <div>
                  <button class="action-btn send-btn" style="padding: 5px 10px; font-size: 0.8rem; margin-right: 5px;">
                    <i class="fas fa-check"></i> Accept
                  </button>
                  <button class="action-btn" style="background: var(--danger); padding: 5px 10px; font-size: 0.8rem;">
                    <i class="fas fa-times"></i> Decline
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="profile-container" id="profileTab" style="display: none;">
          <div class="profile-section">
            <div class="profile-header">
              <div class="profile-avatar" id="profileAvatar">U</div>
              <div class="profile-info">
                <h3 id="profileName">User Name</h3>
                <p id="profileEmail">user@example.com</p>
                <p>Member since <span id="joinDate">2023</span></p>
              </div>
            </div>
            
            <button class="generate-btn" id="editProfileBtn" style="margin-bottom: 20px;">
              <i class="fas fa-edit"></i>
              Edit Profile
            </button>
          </div>
          
          <div class="profile-section">
            <h3>Qualifications</h3>
            <div class="qualification-form" id="qualificationForm" style="display: none;">
              <div class="param-group">
                <label class="param-label">Education Level</label>
                <select class="param-select" id="educationLevel">
                  <option value="">Select</option>
                  <option value="High School">High School</option>
                  <option value="Undergraduate">Undergraduate</option>
                  <option value="Graduate">Graduate</option>
                  <option value="Postgraduate">Postgraduate</option>
                </select>
              </div>
              
              <div class="param-group">
                <label class="param-label">Field of Study</label>
                <input type="text" class="param-input" id="fieldOfStudy" placeholder="e.g. Computer Science">
              </div>
              
              <div class="param-group">
                <label class="param-label">Institution</label>
                <input type="text" class="param-input" id="institution" placeholder="Your school/university">
              </div>
              
              <div class="param-group">
                <label class="param-label">Year of Completion</label>
                <input type="number" class="param-input" id="completionYear" min="1900" max="2100" placeholder="YYYY">
              </div>
              
              <button class="generate-btn" id="saveQualificationBtn">
                <i class="fas fa-save"></i>
                Save Qualifications
              </button>
            </div>
            
            <div id="qualificationsList">
              <div class="qualification-item">
                <h4>Education</h4>
                <p><strong>Level:</strong> Undergraduate</p>
                <p><strong>Field:</strong> Computer Science</p>
                <p><strong>Institution:</strong> State University</p>
                <p><strong>Year:</strong> 2025</p>
              </div>
            </div>
          </div>
          
          <div class="profile-section">
            <h3>Exam Goals</h3>
            <div class="qualification-form" id="examGoalsForm" style="display: none;">
              <div class="param-group">
                <label class="param-label">Target Exam</label>
                <select class="param-select" id="targetExam">
                  <option value="">Select</option>
                  <option value="SAT">SAT</option>
                  <option value="ACT">ACT</option>
                  <option value="GRE">GRE</option>
                  <option value="JEE">JEE</option>
                  <option value="NEET">NEET</option>
                  <option value="GATE">GATE</option>
                  <option value="Other">Other</option>
                </select>
              </div>
              
              <div class="param-group">
                <label class="param-label">Target Date</label>
                <input type="date" class="param-input" id="examDate">
              </div>
              
              <div class="param-group">
                <label class="param-label">Target Score</label>
                <input type="text" class="param-input" id="targetScore" placeholder="e.g. 1500 for SAT">
              </div>
              
              <button class="generate-btn" id="saveExamGoalBtn">
                <i class="fas fa-save"></i>
                Save Exam Goal
              </button>
            </div>
            
            <div id="examGoalsList">
              <div class="qualification-item">
                <h4>Current Goal</h4>
                <p><strong>Exam:</strong> SAT</p>
                <p><strong>Target Date:</strong> June 2024</p>
                <p><strong>Target Score:</strong> 1500</p>
              </div>
            </div>
            
            <button class="generate-btn" id="addExamGoalBtn">
              <i class="fas fa-plus"></i>
              Add Exam Goal
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Login Modal -->
  <div class="modal" id="loginModal">
    <div class="modal-content">
      <div class="modal-title">Log In</div>
      <div class="form-group">
        <label class="form-label">Email</label>
        <input type="email" class="form-input" id="loginEmail">
      </div>
      <div class="form-group">
        <label class="form-label">Password</label>
        <input type="password" class="form-input" id="loginPassword">
      </div>
      <div class="modal-actions">
        <button class="modal-btn modal-cancel" id="loginCancelBtn">Cancel</button>
        <button class="modal-btn modal-submit" id="loginSubmitBtn">Log In</button>
      </div>
    </div>
  </div>

  <!-- Signup Modal -->
  <div class="modal" id="signupModal">
    <div class="modal-content">
      <div class="modal-title">Sign Up</div>
      <div class="form-group">
        <label class="form-label">Name</label>
        <input type="text" class="form-input" id="signupName">
      </div>
      <div class="form-group">
        <label class="form-label">Email</label>
        <input type="email" class="form-input" id="signupEmail">
      </div>
      <div class="form-group">
        <label class="form-label">Password</label>
        <input type="password" class="form-input" id="signupPassword">
      </div>
      <div class="form-group">
        <label class="form-label">Confirm Password</label>
        <input type="password" class="form-input" id="signupConfirmPassword">
      </div>
      <div class="modal-actions">
        <button class="modal-btn modal-cancel" id="signupCancelBtn">Cancel</button>
        <button class="modal-btn modal-submit" id="signupSubmitBtn">Sign Up</button>
      </div>
    </div>
  </div>

  <!-- Edit Profile Modal -->
  <div class="modal" id="editProfileModal">
    <div class="modal-content">
      <div class="modal-title">Edit Profile</div>
      <div class="form-group">
        <label class="form-label">Name</label>
        <input type="text" class="form-input" id="editProfileName">
      </div>
      <div class="form-group">
        <label class="form-label">Email</label>
        <input type="email" class="form-input" id="editProfileEmail">
      </div>
      <div class="form-group">
        <label class="form-label">Change Password</label>
        <div class="chat-container">
          <textarea id="userInput" placeholder="Type your question..."></textarea>
          <button id="sendBtn">Send</button>
          <button id="stopBtn" disabled>Stop</button>
          
          <div class="response-container">
            <div id="aiResponse"></div>
            <button id="copyBtn">Copy</button>
            <button id="editBtn">Edit</button>
          </div>
        </div>
        <script>
          // Backend API Configuration
          const BACKEND_URL = 'http://localhost:3000';
          
          // DOM Elements
          const messageInput = document.getElementById('messageInput');
          const sendBtn = document.getElementById('sendBtn');
          const chatMessages = document.getElementById('chatMessages');
          const typingIndicator = document.getElementById('typingIndicator');
          const fileUpload = document.getElementById('fileUpload');
          const subjectCards = document.querySelectorAll('.subject-card');
          const tabButtons = document.querySelectorAll('.tab-btn');
          const chatTab = document.getElementById('chatTab');
          const testTab = document.getElementById('testTab');
          const flashcardsTab = document.getElementById('flashcardTab');
          const dashboardTab = document.getElementById('dashboardTab');
          const challengeTab = document.getElementById('challengeTab');
          const profileTab = document.getElementById('profileTab');
          const testSubject = document.getElementById('testSubject');
          const testTopic = document.getElementById('testTopic');
          const questionType = document.getElementById('questionType');
          const questionDifficulty = document.getElementById('questionDifficulty');
          const questionCount = document.getElementById('questionCount');
          const timeLimit = document.getElementById('timeLimit');
          const generateTestBtn = document.getElementById('generateTestBtn');
          const testQuestions = document.getElementById('testQuestions');
          const savedList = document.getElementById('savedList');
          const loginBtn = document.getElementById('loginBtn');
          const signupBtn = document.getElementById('signupBtn');
          const authButtons = document.getElementById('authButtons');
          const userProfile = document.getElementById('userProfile');
          const userAvatar = document.getElementById('userAvatar');
          const userName = document.getElementById('userName');
          const loginModal = document.getElementById('loginModal');
          const signupModal = document.getElementById('signupModal');
          const loginCancelBtn = document.getElementById('loginCancelBtn');
          const loginSubmitBtn = document.getElementById('loginSubmitBtn');
          const signupCancelBtn = document.getElementById('signupCancelBtn');
          const signupSubmitBtn = document.getElementById('signupSubmitBtn');
          const gamificationBar = document.getElementById('gamificationBar');
          const xpProgress = document.getElementById('xpProgress');
          const xpText = document.getElementById('xpText');
          const streakCount = document.getElementById('streakCount');
          const presetBtns = document.querySelectorAll('.preset-btn');
          const flashcard = document.getElementById('flashcard');
          const flashcardQuestion = document.getElementById('flashcardQuestion');
          const flashcardAnswer = document.getElementById('flashcardAnswer');
          const knowBtn = document.getElementById('knowBtn');
          const flipBtn = document.getElementById('flipBtn');
          const dontKnowBtn = document.getElementById('dontKnowBtn');
          const generateFlashcardsBtn = document.getElementById('generateFlashcardsBtn');
          const totalQuestions = document.getElementById('totalQuestions');
          const correctAnswers = document.getElementById('correctAnswers');
          const accuracyRate = document.getElementById('accuracyRate');
          const weakAreasList = document.getElementById('weakAreasList');
          const friendEmail = document.getElementById('friendEmail');
          const challengeTopic = document.getElementById('challengeTopic');
          const challengeQuestionCount = document.getElementById('challengeQuestionCount');
          const sendChallengeBtn = document.getElementById('sendChallengeBtn');
          const challengesList = document.getElementById('challengesList');
          const profileAvatar = document.getElementById('profileAvatar');
          const profileName = document.getElementById('profileName');
          const profileEmail = document.getElementById('profileEmail');
          const joinDate = document.getElementById('joinDate');
          const editProfileBtn = document.getElementById('editProfileBtn');
          const qualificationForm = document.getElementById('qualificationForm');
          const educationLevel = document.getElementById('educationLevel');
          const fieldOfStudy = document.getElementById('fieldOfStudy');
          const institution = document.getElementById('institution');
          const completionYear = document.getElementById('completionYear');
          const saveQualificationBtn = document.getElementById('saveQualificationBtn');
          const qualificationsList = document.getElementById('qualificationsList');
          const examGoalsForm = document.getElementById('examGoalsForm');
          const targetExam = document.getElementById('targetExam');
          const examDate = document.getElementById('examDate');
          const targetScore = document.getElementById('targetScore');
          const saveExamGoalBtn = document.getElementById('saveExamGoalBtn');
          const examGoalsList = document.getElementById('examGoalsList');
          const addExamGoalBtn = document.getElementById('addExamGoalBtn');
          const editProfileModal = document.getElementById('editProfileModal');
          const editProfileName = document.getElementById('editProfileName');
          const editProfileEmail = document.getElementById('editProfileEmail');
          const progressChartCanvas = document.getElementById('progressChartCanvas');
          
          // State
          let currentSubject = 'Mathematics';
          let currentTab = 'chat';
          let user = null;
          let savedResponses = [];
          let sessionHistory = [];
          let flashcards = [];
          let currentFlashcardIndex = 0;
          let xp = 30;
          let level = 1;
          let streak = 3;
          let totalQuestionsAnswered = 0;
          let correctAnswersCount = 0;
          let weakAreas = {};
          let progressChart = null;
          let qualifications = [];
          let examGoals = [];
          
          const examPresets = {
            'SAT': {
              subject: 'Mathematics',
              topic: 'SAT Math Practice',
              type: 'Multiple Choice',
              difficulty: 'Medium',
              count: 10,
              time: 60
            },
            'JEE': {
              subject: 'Mathematics',
              topic: 'JEE Advanced Problems',
              type: 'Multiple Choice',
              difficulty: 'Hard',
              count: 15,
              time: 90
            },
            'NEET': {
              subject: 'Science',
              topic: 'NEET Biology Questions',
              type: 'Multiple Choice',
              difficulty: 'Medium',
              count: 12,
              time: 60
            },
            'GATE': {
              subject: 'Computer Science',
              topic: 'GATE CS Algorithms',
              type: 'Multiple Choice',
              difficulty: 'Hard',
              count: 10,
              time: 90
            },
            'CBSE': {
              subject: 'Mathematics',
              topic: 'CBSE Class 12 Board',
              type: 'Multiple Choice',
              difficulty: 'Medium',
              count: 8,
              time: 45
            },
            'ACT': {
              subject: 'Language Arts',
              topic: 'ACT English Practice',
              type: 'Multiple Choice',
              difficulty: 'Medium',
              count: 10,
              time: 45
            },
            'GRE': {
              subject: 'Mathematics',
              topic: 'GRE Quantitative',
              type: 'Multiple Choice',
              difficulty: 'Medium',
              count: 10,
              time: 60
            },
            'IELTS': {
              subject: 'Language Arts',
              topic: 'IELTS Reading',
              type: 'Multiple Choice',
              difficulty: 'Medium',
              count: 8,
              time: 45
            }
          };
          
          // Initialize
          document.addEventListener('DOMContentLoaded', () => {
            // Load saved data from localStorage
            const savedUser = localStorage.getItem('examPrepUser');
            if (savedUser) {
              user = JSON.parse(savedUser);
              authButtons.style.display = 'none';
              userProfile.style.display = 'flex';
              userAvatar.textContent = user.name.charAt(0).toUpperCase();
              userName.textContent = user.name;
              profileAvatar.textContent = user.name.charAt(0).toUpperCase();
              profileName.textContent = user.name;
              profileEmail.textContent = user.email;
              joinDate.textContent = new Date(user.joined).toLocaleDateString();
              gamificationBar.style.display = 'flex';
              
              // Load profile data
              loadProfileData();
            }
            
            const savedResponsesData = localStorage.getItem('savedResponses');
            if (savedResponsesData) {
              savedResponses = JSON.parse(savedResponsesData);
              renderSavedResponses();
            }
            
            const sessionHistoryData = localStorage.getItem('sessionHistory');
            if (sessionHistoryData) {
              sessionHistory = JSON.parse(sessionHistoryData);
            }
            
            const flashcardsData = localStorage.getItem('flashcards');
            if (flashcardsData) {
              flashcards = JSON.parse(flashcardsData);
              if (flashcards.length > 0) {
                showFlashcard(0);
              }
            }
            
            const gamificationData = localStorage.getItem('gamificationData');
            if (gamificationData) {
              const data = JSON.parse(gamificationData);
              xp = data.xp;
              level = data.level;
              streak = data.streak;
              totalQuestionsAnswered = data.totalQuestionsAnswered;
              correctAnswersCount = data.correctAnswersCount;
              weakAreas = data.weakAreas || {};
              updateGamificationUI();
              updateDashboardStats();
            }
            
            // Initialize chart
            initProgressChart();
            
            // Initial greeting
            setTimeout(() => {
              addMessage("Hello! I'm your AI Exam Preparation Tutor. How can I help you study today?", 'bot');
            }, 500);
          });
          
          // Set up subject selection
          subjectCards.forEach(card => {
            card.addEventListener('click', () => {
              subjectCards.forEach(c => c.classList.remove('active'));
              card.classList.add('active');
              currentSubject = card.textContent.trim();
              
              // Update test subject dropdown to match
              testSubject.value = currentSubject;
            });
          });
          
          // Tab switching
          tabButtons.forEach(button => {
            button.addEventListener('click', () => {
              tabButtons.forEach(btn => btn.classList.remove('active'));
              button.classList.add('active');
              currentTab = button.dataset.tab;
              
              chatTab.style.display = 'none';
              testTab.style.display = 'none';
              flashcardsTab.style.display = 'none';
              dashboardTab.style.display = 'none';
              challengeTab.style.display = 'none';
              profileTab.style.display = 'none';
              
              if (currentTab === 'chat') {
                chatTab.style.display = 'flex';
              } else if (currentTab === 'test') {
                testTab.style.display = 'flex';
              } else if (currentTab === 'flashcards') {
                flashcardsTab.style.display = 'flex';
              } else if (currentTab === 'dashboard') {
                dashboardTab.style.display = 'flex';
                updateProgressChart();
              } else if (currentTab === 'challenge') {
                challengeTab.style.display = 'flex';
              } else if (currentTab === 'profile') {
                profileTab.style.display = 'flex';
              }
            });
          });
          
          // Initialize progress chart
          function initProgressChart() {
            const ctx = progressChartCanvas.getContext('2d');
            progressChart = new Chart(ctx, {
              type: 'line',
              data: {
                labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6'],
                datasets: [
                  {
                    label: 'Questions Answered',
                    data: [15, 30, 45, 60, 75, 90],
                    borderColor: '#4361ee',
                    backgroundColor: 'rgba(67, 97, 238, 0.1)',
                    tension: 0.3,
                    fill: true
                  },
                  {
                    label: 'Correct Answers',
                    data: [10, 25, 40, 50, 65, 80],
                    borderColor: '#4cc9f0',
                    backgroundColor: 'rgba(76, 201, 240, 0.1)',
                    tension: 0.3,
                    fill: true
                  }
                ]
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                  y: {
                    beginAtZero: true
                  }
                }
              }
            });
          }
          
          // Update progress chart with real data
          function updateProgressChart() {
            if (!progressChart) return;
            
            // In a real app, this would fetch actual progress data
            const weeks = ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6'];
            const questionsData = [15, 30, 45, 60, 75, 90];
            const correctData = questionsData.map(val => Math.floor(val * 0.85));
            
            progressChart.data.labels = weeks;
            progressChart.data.datasets[0].data = questionsData;
            progressChart.data.datasets[1].data = correctData;
            progressChart.update();
          }
          
          // Load profile data
          function loadProfileData() {
            // In a real app, this would fetch from backend
            const savedQualifications = localStorage.getItem('qualifications');
            if (savedQualifications) {
              qualifications = JSON.parse(savedQualifications);
              renderQualifications();
            }
            
            const savedExamGoals = localStorage.getItem('examGoals');
            if (savedExamGoals) {
              examGoals = JSON.parse(savedExamGoals);
              renderExamGoals();
            }
          }
          
          // Render qualifications
          function renderQualifications() {
            if (qualifications.length === 0) {
              qualificationsList.innerHTML = '<p>No qualifications added yet.</p>';
              return;
            }
            
            qualificationsList.innerHTML = qualifications.map(qual => `
              <div class="qualification-item">
                <h4>Education</h4>
                <p><strong>Level:</strong> ${qual.educationLevel}</p>
                <p><strong>Field:</strong> ${qual.fieldOfStudy}</p>
                <p><strong>Institution:</strong> ${qual.institution}</p>
                <p><strong>Year:</strong> ${qual.completionYear}</p>
              </div>
            `).join('');
          }
          
          // Render exam goals
          function renderExamGoals() {
            if (examGoals.length === 0) {
              examGoalsList.innerHTML = '<p>No exam goals set yet.</p>';
              return;
            }
            
            examGoalsList.innerHTML = examGoals.map(goal => `
              <div class="qualification-item">
                <h4>Current Goal</h4>
                <p><strong>Exam:</strong> ${goal.targetExam}</p>
                <p><strong>Target Date:</strong> ${new Date(goal.examDate).toLocaleDateString()}</p>
                <p><strong>Target Score:</strong> ${goal.targetScore}</p>
              </div>
            `).join('');
          }
          
          // Send message function with typing animation
          async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;
        
            addMessage(message, 'user');
            messageInput.value = '';
            typingIndicator.style.display = 'flex';
        
            try {
              const response = await fetch(`${BACKEND_URL}/api/chat`, {
                method: 'POST',
                headers: { 
                  'Content-Type': 'application/json',
                  'Authorization': user ? `Bearer ${localStorage.getItem('token')}` : ''
                },
                body: JSON.stringify({
                  message: message,
                  subject: currentSubject || "General"
                })
              });
        
              if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || `HTTP Error: ${response.status}`);
              }
        
              const data = await response.json();
              
              // Format the response with markdown
              const formattedResponse = formatResponse(data.reply);
              
              // Animate the response typing
              simulateTyping(formattedResponse, 'bot');
              
              // Update gamification
              addXP(5);
              incrementQuestions();
              
            } catch (error) {
              console.error("Error:", error);
              addMessage(`Error: ${error.message}`, 'bot');
            } finally {
              typingIndicator.style.display = 'none';
            }
          }
          
          // Format AI response to clean plain text
          function formatResponse(text, isContinuing = false) {
  // Remove all markdown formatting
  let cleanText = text
    .replace(/[#*_`|<>-]/g, '')
    .replace(/\n{3,}/g, '\n\n')
    .trim();

  // Split into lines
  const lines = cleanText.split('\n');
  let output = '';
  let lineCount = 0;

  // Process lines in chunks
  for (let i = 0; i < lines.length; i++) {
    // Skip empty lines for counting
    if (lines[i].trim() === '') continue;
    
    lineCount++;
    output += lines[i] + '\n';

    // Insert summary and prompt after 20 non-empty lines
    if (lineCount % 20 === 0 && i < lines.length - 1) {
      output += `\n[Summary up to this point...]\n`;
      output += `[Would you like to continue? Type 'yes' to see more]\n`;
      break; // Stop processing further lines
    }
  }

  // If we're continuing, don't show the prompt again
  if (isContinuing && lineCount >= 20) {
    output = cleanText; // Return full text if continuing
  }

  return output;
}

// Example usage with continuation logic
function handleAIResponse(fullResponse, userInput = '') {
  const wantsToContinue = userInput.toLowerCase().includes('yes');
  return formatResponse(fullResponse, wantsToContinue);
}
          // Simulate typing animation for bot messages
          function simulateTyping(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            
            messageDiv.appendChild(contentDiv);
            chatMessages.appendChild(messageDiv);
            
            let i = 0;
            const speed = 20; // milliseconds per character
            
            function typeWriter() {
              if (i < text.length) {
                contentDiv.innerHTML += text.charAt(i);
                i++;
                setTimeout(typeWriter, speed);
                
                // Scroll to bottom
                chatMessages.scrollTop = chatMessages.scrollHeight;
              }
            }
            
            typeWriter();
          }
          
          // Generate test function
          async function generateTest() {
            const subject = testSubject.value;
            const topic = testTopic.value.trim();
            const type = questionType.value;
            const difficulty = questionDifficulty.value;
            const count = questionCount.value;
        
            if (!topic) {
              alert("Please enter a topic");
              return;
            }
        
            generateTestBtn.disabled = true;
            generateTestBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';
        
            try {
              const response = await fetch(`${BACKEND_URL}/api/generate-test`, {
                method: 'POST',
                headers: { 
                  'Content-Type': 'application/json',
                  'Authorization': user ? `Bearer ${localStorage.getItem('token')}` : ''
                },
                body: JSON.stringify({
                  subject,
                  topic,
                  type,
                  difficulty,
                  count
                })
              });
        
              if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || `HTTP Error: ${response.status}`);
              }
        
              const data = await response.json();
              
              // Format and display the test with animation
              animateTestDisplay(data.test);
              
              // Update gamification
              addXP(10);
              
            } catch (error) {
              console.error("Error:", error);
              testQuestions.innerHTML = `<p class="error">${error.message}</p>`;
            } finally {
              generateTestBtn.disabled = false;
              generateTestBtn.innerHTML = '<i class="fas fa-magic"></i> Generate Test';
            }
          }
          
          // Animate test display
          function animateTestDisplay(content) {
            testQuestions.innerHTML = '';
            const questions = content.split('\n\n');
            
            questions.forEach((question, index) => {
              setTimeout(() => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-item fade-in';
                questionDiv.innerHTML = question.replace(/\n/g, '<br>');
                testQuestions.appendChild(questionDiv);
                
                // Scroll to bottom
                testQuestions.scrollTop = testQuestions.scrollHeight;
              }, index * 200);
            });
          }
          
          // Set up exam presets
          presetBtns.forEach(btn => {
            btn.addEventListener('click', () => {
              const exam = btn.dataset.exam;
              const preset = examPresets[exam];
              
              testSubject.value = preset.subject;
              testTopic.value = preset.topic;
              questionType.value = preset.type;
              questionDifficulty.value = preset.difficulty;
              questionCount.value = preset.count;
              timeLimit.value = preset.time;
              
              // Animate the button click
              btn.classList.add('pulse');
              setTimeout(() => {
                btn.classList.remove('pulse');
              }, 1000);
            });
          });
          
          // Flashcard functions
          function showFlashcard(index) {
            if (flashcards.length === 0) {
              flashcardQuestion.textContent = "No flashcards available. Generate some first!";
              flashcardAnswer.textContent = "";
              return;
            }
            
            if (index >= flashcards.length) index = 0;
            if (index < 0) index = flashcards.length - 1;
            
            currentFlashcardIndex = index;
            flashcardQuestion.textContent = flashcards[index].question;
            flashcardAnswer.textContent = flashcards[index].answer;
            flashcard.classList.remove('flipped');
          }
          
          function generateFlashcards() {
            // In a real app, this would fetch from the backend based on weak areas
            const sampleFlashcards = [
              { question: "What is the Pythagorean theorem?", answer: "a + b = c for right triangles" },
              { question: "What is Newton's First Law?", answer: "An object in motion stays in motion unless acted upon by an external force" },
              { question: "What is the capital of France?", answer: "Paris" },
  // Data Structures & Algorithms (10)
  { question: "What is a hash table?", answer: "A data structure that implements an associative array using key-value pairs" },
  { question: "What is Big O notation?", answer: "A mathematical notation describing algorithm complexity in worst-case scenarios" },
  { question: "What is the time complexity of binary search?", answer: "O(log n)" },
  { question: "What data structure uses LIFO principle?", answer: "Stack" },
  { question: "What is Dijkstra's algorithm used for?", answer: "Finding shortest paths between nodes in a graph" },
  { question: "What is the quadratic formula?", answer: "x = [-b  (b-4ac)]/2a for equations ax+bx+c=0" },
  { question: "What is the value of  to 5 decimal places?", answer: "3.14159" },
  { question: "What is the derivative of x?", answer: "2x" },
  { question: "What is the fundamental theorem of calculus?", answer: "Relates differentiation and integration as inverse operations" },
  { question: "What is a prime number?", answer: "A natural number greater than 1 with no positive divisors other than 1 and itself" },
  { question: "What is the Fibonacci sequence?", answer: "A series where each number is the sum of the two preceding ones (0,1,1,2,3,5...)" },
  { question: "What is Euler's formula?", answer: "e^(i) + 1 = 0 relating exponential and trigonometric functions" },
  { question: "What is the Pythagorean theorem?", answer: "a + b = c for right triangles" },
  { question: "What is the binomial theorem?", answer: "(a+b) = (n choose k)ab for k=0 to n" },
  { question: "What is a matrix determinant?", answer: "A scalar value that can be computed from square matrices and encodes linear transformation properties" },

 
  // Computer Science (5)
  { question: "What is the Turing test?", answer: "A test of a machine's ability to exhibit intelligent behavior indistinguishable from a human" },
  { question: "What does CPU stand for?", answer: "Central Processing Unit" },
  { question: "What is the difference between HTTP and HTTPS?", answer: "HTTPS is the secure version with encryption via SSL/TLS" },
  { question: "What is object-oriented programming?", answer: "A programming paradigm based on objects containing data and methods" },
  { question: "What is the difference between RAM and ROM?", answer: "RAM is volatile temporary memory, ROM is non-volatile permanent memory" },

  // Artificial Intelligence (5)
  { question: "What is machine learning?", answer: "Algorithms that improve automatically through experience" },
  { question: "What is a neural network?", answer: "A system modeled after the human brain's interconnected neurons" },
  { question: "What is the difference between supervised and unsupervised learning?", answer: "Supervised uses labeled data, unsupervised finds patterns in unlabeled data" },
  { question: "What is NLP in AI?", answer: "Natural Language Processing - enabling computers to understand human language" },
  { question: "What is reinforcement learning?", answer: "Learning through rewards/punishments from actions in an environment" },

  // Language Arts (5)
  { question: "What is a metaphor?", answer: "A figure of speech comparing two unlike things without 'like' or 'as'" },
  { question: "Who wrote 'Romeo and Juliet'?", answer: "William Shakespeare" },
  { question: "What is the difference between a simile and a metaphor?", answer: "Simile uses 'like' or 'as', metaphor makes direct comparison" },
  { question: "What is alliteration?", answer: "Repetition of initial consonant sounds in neighboring words" },
  { question: "What are the three main types of irony?", answer: "Verbal, situational, and dramatic" },


            ];
            
            flashcards = sampleFlashcards;
            localStorage.setItem('flashcards', JSON.stringify(flashcards));
            showFlashcard(0);
            
            // Animate the generation
            generateFlashcardsBtn.classList.add('pulse');
            setTimeout(() => {
              generateFlashcardsBtn.classList.remove('pulse');
            }, 1000);
          }
          
          function markFlashcard(know) {
            if (know) {
              addXP(3);
              correctAnswersCount++;
            } else {
              // Add to weak areas
              const topic = currentSubject;
              weakAreas[topic] = weakAreas[topic] || { total: 0, correct: 0 };
              weakAreas[topic].total++;
            }
            
            totalQuestionsAnswered++;
            updateDashboardStats();
            saveGamificationData();
            
            // Move to next card
            currentFlashcardIndex++;
            if (currentFlashcardIndex >= flashcards.length) currentFlashcardIndex = 0;
            showFlashcard(currentFlashcardIndex);
          }
          
          // Gamification functions
          function addXP(points) {
            if (!user) return;
            
            xp += points;
            if (xp >= 100) {
              level++;
              xp = xp - 100;
              showLevelUpNotification();
            }
            
            updateGamificationUI();
            saveGamificationData();
          }
          
          function incrementQuestions() {
            if (!user) return;
            
            totalQuestionsAnswered++;
            updateDashboardStats();
            saveGamificationData();
          }
          
          function updateGamificationUI() {
            xpProgress.style.width = `${xp}%`;
            xpText.textContent = `${xp}/100 XP`;
            streakCount.textContent = `${streak} day streak`;
            
            // Unlock badges based on progress
            if (totalQuestionsAnswered >= 10) {
              document.getElementById('badge2').style.display = 'flex';
            }
          }
          
          function updateDashboardStats() {
            totalQuestions.textContent = totalQuestionsAnswered;
            correctAnswers.textContent = correctAnswersCount;
            
            const accuracy = totalQuestionsAnswered > 0 
              ? Math.round((correctAnswersCount / totalQuestionsAnswered) * 100)
              : 0;
            accuracyRate.textContent = `${accuracy}%`;
            
            // Update weak areas
            weakAreasList.innerHTML = Object.entries(weakAreas).map(([topic, stats]) => {
              const accuracy = stats.total > 0 
                ? Math.round((stats.correct / stats.total) * 100)
                : 0;
              return `<div class="weak-area-item">
                <strong>${topic}</strong> - ${accuracy}% accuracy (${stats.total} questions)
              </div>`;
            }).join('');
          }
          
          function showLevelUpNotification() {
            const notification = document.createElement('div');
            notification.className = 'mindfulness-popup show';
            notification.innerHTML = `
              <div class="mindfulness-title">
                <i class="fas fa-trophy"></i>
                <span>Level Up!</span>
              </div>
              <div class="mindfulness-text">
                Congratulations! You've reached Level ${level}
              </div>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
              notification.remove();
            }, 3000);
          }
          
          function saveGamificationData() {
            if (!user) return;
            
            const data = {
              xp,
              level,
              streak,
              totalQuestionsAnswered,
              correctAnswersCount,
              weakAreas
            };
            
            localStorage.setItem('gamificationData', JSON.stringify(data));
          }
          
          // Challenge functions
          async function sendChallenge() {
            const email = friendEmail.value.trim();
            const topic = challengeTopic.value.trim();
            const count = challengeQuestionCount.value;
            
            if (!email || !topic) {
              alert("Please enter both friend's email and topic");
              return;
            }
        
            sendChallengeBtn.disabled = true;
            sendChallengeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
        
            try {
              const response = await fetch(`${BACKEND_URL}/api/challenges`, {
                method: 'POST',
                headers: { 
                  'Content-Type': 'application/json',
                  'Authorization': `Bearer ${localStorage.getItem('token')}`
                },
                body: JSON.stringify({
                  toEmail: email,
                  topic,
                  questionCount: count
                })
              });
        
              if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || `HTTP Error: ${response.status}`);
              }
        
              const data = await response.json();
              
              // Add to challenges list
              challengesList.insertAdjacentHTML('afterbegin', `
                <div class="challenge-item">
                  <div>
                    <strong>${topic}</strong> - Sent to ${email} (Pending)
                  </div>
                  <button class="action-btn" style="background: var(--danger); padding: 5px 10px; font-size: 0.8rem;">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              `);
              
              // Clear form
              friendEmail.value = '';
              challengeTopic.value = '';
              challengeQuestionCount.value = 5;
              
              // Show success message
              alert(`Challenge sent to ${email}`);
              
            } catch (error) {
              console.error("Error:", error);
              alert(`Failed to send challenge: ${error.message}`);
            } finally {
              sendChallengeBtn.disabled = false;
              sendChallengeBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Send Challenge';
            }
          }
          
          // Profile functions
          editProfileBtn.addEventListener('click', () => {
            editProfileName.value = user.name;
            editProfileEmail.value = user.email;
            editProfileModal.style.display = 'flex';
          });
          
          // Save qualifications
          saveQualificationBtn.addEventListener('click', () => {
            const qualification = {
              educationLevel: educationLevel.value,
              fieldOfStudy: fieldOfStudy.value,
              institution: institution.value,
              completionYear: completionYear.value
            };
            
            qualifications = [qualification];
            localStorage.setItem('qualifications', JSON.stringify(qualifications));
            renderQualifications();
            
            // Hide form
            qualificationForm.style.display = 'none';
          });
          
          // Add exam goal
          addExamGoalBtn.addEventListener('click', () => {
            examGoalsForm.style.display = 'grid';
            addExamGoalBtn.style.display = 'none';
          });
          
          // Save exam goal
          saveExamGoalBtn.addEventListener('click', () => {
            const examGoal = {
              targetExam: targetExam.value,
              examDate: examDate.value,
              targetScore: targetScore.value
            };
            
            examGoals = [examGoal];
            localStorage.setItem('examGoals', JSON.stringify(examGoals));
            renderExamGoals();
            
            // Hide form and show add button
            examGoalsForm.style.display = 'none';
            addExamGoalBtn.style.display = 'block';
          });
          
          // Add message to chat with animation
          function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message fade-in`;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            
            if (sender === 'bot') {
              contentDiv.innerHTML = text;
            } else {
              contentDiv.textContent = text;
            }
            
            messageDiv.appendChild(contentDiv);
            chatMessages.appendChild(messageDiv);
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
          }
          
          // Render saved responses
          function renderSavedResponses() {
            savedList.innerHTML = savedResponses.map((item, index) => {
              const title = item.type === 'test' 
                ? `Test: ${item.topic} (${item.subject})`
                : `Q: ${item.question.substring(0, 30)}... (${item.subject})`;
              
              return `<div class="saved-item" data-index="${index}">
                ${title}
                <small>${new Date(item.timestamp).toLocaleString()}</small>
              </div>`;
            }).join('');
            
            // Add click handlers
            document.querySelectorAll('.saved-item').forEach(item => {
              item.addEventListener('click', () => {
                const index = item.dataset.index;
                const savedItem = savedResponses[index];
                
                if (savedItem.type === 'test') {
                  // Switch to test tab and display
                  document.querySelector('.tab-btn[data-tab="test"]').click();
                  testSubject.value = savedItem.subject;
                  testTopic.value = savedItem.topic;
                  testQuestions.innerHTML = formatTestQuestions(savedItem.content);
                } else {
                  // Switch to chat tab and show Q&A
                  document.querySelector('.tab-btn[data-tab="chat"]').click();
                  addMessage(savedItem.question, 'user');
                  addMessage(savedItem.answer, 'bot');
                }
              });
            });
          }
          
          // Format test questions for display
          function formatTestQuestions(content) {
            return '<div class="question-item">' + 
              content.split('\n').map(line => {
                if (line.trim() === '') return '<br>';
                return `<p class="question-text">${line}</p>`;
              }).join('') + 
              '</div>';
          }
          
          // Auth functions
          function showLoginModal() {
            loginModal.style.display = 'flex';
          }
          
          function hideLoginModal() {
            loginModal.style.display = 'none';
          }
          
          function showSignupModal() {
            signupModal.style.display = 'flex';
          }
          
          function hideSignupModal() {
            signupModal.style.display = 'none';
          }
          
          async function loginUser(email, password) {
            if (!email || !password) {
              alert('Please enter both email and password');
              return;
            }
            
            try {
              const response = await fetch(`${BACKEND_URL}/api/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
              });
              
              if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || 'Login failed');
              }
              
              const data = await response.json();
              user = data.user;
              localStorage.setItem('examPrepUser', JSON.stringify(user));
              localStorage.setItem('token', data.token);
              
              authButtons.style.display = 'none';
              userProfile.style.display = 'flex';
              gamificationBar.style.display = 'flex';
              userAvatar.textContent = user.name.charAt(0).toUpperCase();
              userName.textContent = user.name;
              profileAvatar.textContent = user.name.charAt(0).toUpperCase();
              profileName.textContent = user.name;
              profileEmail.textContent = user.email;
              joinDate.textContent = new Date(user.joined).toLocaleDateString();
              hideLoginModal();
              
              // Load user-specific data
              loadProfileData();
              
              // Show welcome message
              addMessage(`Welcome back, ${user.name}! Ready to continue learning?`, 'bot');
              
            } catch (error) {
              console.error("Login error:", error);
              alert(error.message);
            }
          }
          
          async function signupUser(name, email, password, confirmPassword) {
            if (!name || !email || !password || !confirmPassword) {
              alert('Please fill all fields');
              return;
            }
            
            if (password !== confirmPassword) {
              alert('Passwords do not match');
              return;
            }
            
            if (password.length < 6) {
              alert('Password must be at least 6 characters');
              return;
            }
            
            try {
              const response = await fetch(`${BACKEND_URL}/api/register`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, email, password })
              });
              
              if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || 'Registration failed');
              }
              
              const data = await response.json();
              user = data.user;
              localStorage.setItem('examPrepUser', JSON.stringify(user));
              localStorage.setItem('token', data.token);
              
              authButtons.style.display = 'none';
              userProfile.style.display = 'flex';
              gamificationBar.style.display = 'flex';
              userAvatar.textContent = user.name.charAt(0).toUpperCase();
              userName.textContent = user.name;
              profileAvatar.textContent = user.name.charAt(0).toUpperCase();
              profileName.textContent = user.name;
              profileEmail.textContent = user.email;
              joinDate.textContent = new Date(user.joined).toLocaleDateString();
              hideSignupModal();
              
              // Show welcome message
              addMessage(`Welcome to ExamPrep AI Tutor, ${name}! How can I help you study today?`, 'bot');
              
            } catch (error) {
              console.error("Signup error:", error);
              alert(error.message);
            }
          }
          
          function logoutUser() {
            user = null;
            localStorage.removeItem('examPrepUser');
            localStorage.removeItem('token');
            authButtons.style.display = 'flex';
            userProfile.style.display = 'none';
            gamificationBar.style.display = 'none';
            
            // Show goodbye message
            addMessage("You've been logged out. Come back soon!", 'bot');
          }
          
          // Event listeners
          sendBtn.addEventListener('click', sendMessage);
          messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
              e.preventDefault();
              sendMessage();
            }
          });
          
          generateTestBtn.addEventListener('click', generateTest);
          generateFlashcardsBtn.addEventListener('click', generateFlashcards);
          sendChallengeBtn.addEventListener('click', sendChallenge);
          
          // Flashcard navigation
          flipBtn.addEventListener('click', () => {
            flashcard.classList.toggle('flipped');
          });
          
          knowBtn.addEventListener('click', () => {
            markFlashcard(true);
          });
          
          dontKnowBtn.addEventListener('click', () => {
            markFlashcard(false);
          });
          
          // File upload handler
          fileUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            
            addMessage(`[Uploaded file: ${file.name}]`, 'user');
            addMessage("I see you've uploaded a file. In a full implementation, I would analyze this to help with your exam preparation.", 'bot');
          });
          
          // Auth event listeners
          loginBtn.addEventListener('click', showLoginModal);
          signupBtn.addEventListener('click', showSignupModal);
          loginCancelBtn.addEventListener('click', hideLoginModal);
          signupCancelBtn.addEventListener('click', hideSignupModal);
          
          loginSubmitBtn.addEventListener('click', () => {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            loginUser(email, password);
          });
          
          signupSubmitBtn.addEventListener('click', () => {
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;
            signupUser(name, email, password, confirmPassword);
          });
          
          // Close modals when clicking outside
          window.addEventListener('click', (e) => {
            if (e.target === loginModal) hideLoginModal();
            if (e.target === signupModal) hideSignupModal();
            if (e.target === editProfileModal) editProfileModal.style.display = 'none';
          });
          
          // User profile click
          userProfile.addEventListener('click', () => {
            if (confirm('Do you want to log out?')) {
              logoutUser();
            }
          });
          let currentRequestId = null;

// Send message
document.getElementById('sendBtn').addEventListener('click', async () => {
  const message = document.getElementById('userInput').value;
  currentRequestId = Date.now().toString();
  
  document.getElementById('stopBtn').disabled = false;
  document.getElementById('aiResponse').innerHTML = "Generating...";
  
  const response = await fetch('/api/chat', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ message, requestId: currentRequestId })
  });
  
  const data = await response.json();
  document.getElementById('aiResponse').innerText = data.reply;
});

// Stop generation
document.getElementById('stopBtn').addEventListener('click', async () => {
  await fetch('/api/stop', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ requestId: currentRequestId })
  });
  document.getElementById('stopBtn').disabled = true;
});

// Copy response
document.getElementById('copyBtn').addEventListener('click', () => {
  const text = document.getElementById('aiResponse').innerText;
  navigator.clipboard.writeText(text);
  alert('Copied to clipboard!');
});

// Edit input
document.getElementById('editBtn').addEventListener('click', () => {
  const responseText = document.getElementById('aiResponse').innerText;
  document.getElementById('userInput').value = responseText;
});
        </script>